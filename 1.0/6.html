<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UltraPlay OS v4.0 | Onyx</title>
    <meta name="description" content="High-performance web media player with persistent state">
    <style>
        :root {
            --bg-base: #050505;
            --bg-panel: rgba(18, 18, 18, 0.95);
            --bg-surface: rgba(255, 255, 255, 0.05);
            --border: 1px solid rgba(255, 255, 255, 0.08);
            --primary: #00f2ff;
            --primary-dim: rgba(0, 242, 255, 0.15);
            --text-main: #ffffff;
            --text-muted: #a0a0a0;
            --radius-md: 12px;
            --font: 'Segoe UI', system-ui, sans-serif;
            --blur: 20px;
            --header-h: 70px;
        }

        [data-theme="light"] {
            --bg-base: #eef2f5;
            --bg-panel: rgba(255, 255, 255, 0.95);
            --bg-surface: rgba(0, 0, 0, 0.04);
            --border: 1px solid rgba(0, 0, 0, 0.08);
            --primary: #0066ff;
            --primary-dim: rgba(0, 102, 255, 0.1);
            --text-main: #1a1a1a;
            --text-muted: #666;
        }

        * { box-sizing: border-box; outline: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg-base); color: var(--text-main); font-family: var(--font); height: 100vh; overflow: hidden; transition: background 0.3s; }
        
        /* Layout Grid */
        #app { display: grid; grid-template-columns: 240px 1fr 320px; grid-template-rows: 1fr 90px; height: 100%; width: 100%; }

        /* Left Sidebar */
        .sidebar { background: var(--bg-panel); border-right: var(--border); padding: 20px 12px; display: flex; flex-direction: column; gap: 8px; backdrop-filter: blur(var(--blur)); z-index: 50; }
        .logo { font-size: 1.2rem; font-weight: 800; color: var(--text-main); margin-bottom: 20px; padding-left: 10px; display: flex; align-items: center; gap: 10px; letter-spacing: 1px;}
        .logo span { color: var(--primary); font-size: 0.7em; border: 1px solid var(--primary); padding: 2px 6px; border-radius: 4px; }
        
        .nav-item { padding: 11px 14px; border-radius: var(--radius-md); cursor: pointer; color: var(--text-muted); font-size: 0.9rem; font-weight: 500; display: flex; align-items: center; gap: 12px; transition: 0.2s; position: relative; overflow: hidden; }
        .nav-item:hover { background: var(--bg-surface); color: var(--text-main); }
        .nav-item.active { background: var(--primary-dim); color: var(--primary); font-weight: 700; }
        .nav-item.active::before { content:''; position: absolute; left: 0; top: 20%; height: 60%; width: 4px; background: var(--primary); border-radius: 0 4px 4px 0;}
        .search-box { background: var(--bg-surface); border: var(--border); color: var(--text-main); padding: 12px; border-radius: 8px; width: 100%; margin-bottom: 10px; transition: 0.2s;}
        .search-box:focus { border-color: var(--primary); }

        /* Drop Zone UI */
        .drop-target { border: 2px dashed var(--primary) !important; background: var(--primary-dim) !important; }

        /* Center Stage */
        .stage { grid-column: 2; grid-row: 1; position: relative; background: #000; overflow: hidden; display: flex; flex-direction: column; }
        
        /* Views System */
        .view-section { position: absolute; inset: 0; background: var(--bg-base); display: none; overflow: hidden; flex-direction: column; }
        .view-section.active { display: flex; }
        
        /* Player View */
        #view-player { background: #000; align-items: center; justify-content: center; }
        .ambient-bg { position: absolute; inset: 0; opacity: 0.3; filter: blur(80px); transition: background 1s ease; z-index: 0; }
        video { max-width: 100%; max-height: 100%; z-index: 10; width: 100%; height: 100%; object-fit: contain; }
        #visualizer { position: absolute; bottom: 0; left: 0; width: 100%; height: 40%; z-index: 5; pointer-events: none; mix-blend-mode: screen; opacity: 0.8; }
        .empty-state { color: var(--text-muted); text-align: center; z-index: 10; display: flex; flex-direction: column; align-items: center; gap: 10px; }

        /* Library View */
        .view-header { padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); backdrop-filter: blur(10px); z-index: 20; border-bottom: var(--border); }
        .lib-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 16px; padding: 25px; overflow-y: auto; height: 100%; }
        
        /* Media Card */
        .media-card { background: var(--bg-surface); border: var(--border); border-radius: var(--radius-md); overflow: hidden; cursor: pointer; transition: 0.25s cubic-bezier(0.2, 0.8, 0.2, 1); position: relative; group: 1; }
        .media-card:hover { transform: translateY(-5px); border-color: var(--primary); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .media-card .thumb { height: 110px; background: #111; position: relative; display: flex; align-items: center; justify-content: center; background-size: cover; background-position: center; }
        .media-card .info { padding: 12px; }
        .media-card .title { font-size: 0.85rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .media-card .meta { font-size: 0.7rem; color: var(--text-muted); display: flex; justify-content: space-between; margin-top: 6px; }
        .btn-fav-card { position: absolute; top: 6px; right: 6px; z-index: 5; opacity: 0; transform: scale(0.8); transition: 0.2s; }
        .media-card:hover .btn-fav-card, .btn-fav-card.is-fav { opacity: 1; transform: scale(1); }
        
        /* Right Panel (Queue) */
        .panel { grid-column: 3; grid-row: 1; background: var(--bg-panel); border-left: var(--border); display: flex; flex-direction: column; backdrop-filter: blur(var(--blur)); overflow: hidden; z-index: 50;}
        .panel-head { padding: 20px; font-weight: 700; border-bottom: var(--border); display: flex; justify-content: space-between; align-items: center; }
        .queue-list { overflow-y: auto; flex: 1; padding: 10px; }
        .q-item { display: flex; align-items: center; gap: 10px; padding: 10px; border-radius: 8px; font-size: 0.85rem; margin-bottom: 4px; cursor: pointer; transition: 0.2s; border: 1px solid transparent;}
        .q-item:hover { background: var(--bg-surface); }
        .q-item.active { background: var(--primary-dim); border-color: var(--primary); }
        .q-item.dragging { opacity: 0.4; border: 1px dashed var(--text-muted); }

        /* Bottom Controls */
        .controls { grid-column: 1 / -1; grid-row: 2; background: var(--bg-panel); border-top: var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; backdrop-filter: blur(30px); position: relative; z-index: 100;}
        .seek-wrap { position: absolute; top: -10px; left: 0; right: 0; height: 12px; z-index: 20; cursor: pointer; }
        .seek-bg { position: absolute; bottom: 0; width: 100%; height: 3px; background: rgba(255,255,255,0.1); transition: height 0.2s; }
        .seek-fill { height: 100%; width: 0%; background: var(--primary); position: relative; box-shadow: 0 0 15px var(--primary); }
        .seek-wrap:hover .seek-bg { height: 5px; }

        .btn { background: none; border: none; color: var(--text-muted); cursor: pointer; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .btn:hover { color: var(--text-main); background: var(--bg-surface); }
        .btn.active { color: var(--primary); background: var(--primary-dim); }
        .btn-big { width: 45px; height: 45px; background: var(--text-main); color: #000; border-radius: 50%; transform: scale(1); box-shadow: 0 5px 15px rgba(255,255,255,0.1); }
        .btn-big:hover { background: var(--primary); transform: scale(1.1); color: #000; }
        
        .track-info { display: flex; align-items: center; gap: 12px; width: 250px; }
        .track-thumb { width: 42px; height: 42px; border-radius: 6px; background: #222; background-size: cover; background-position: center; }
        .track-meta { display: flex; flex-direction: column; overflow: hidden; }
        .track-title { font-size: 0.9rem; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .track-time { font-size: 0.75rem; color: var(--text-muted); font-family: monospace; }

        /* Modals */
        .modal-mask { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); z-index: 1000; display: none; align-items: center; justify-content: center; }
        .modal-mask.open { display: flex; animation: fadeUp 0.3s; }
        .modal { width: 400px; max-width: 90vw; background: var(--bg-panel); border: var(--border); border-radius: 16px; padding: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .modal h2 { margin: 0 0 20px 0; font-size: 1.2rem; display: flex; justify-content: space-between; }
        .setting-grp { margin-bottom: 20px; }
        .setting-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-size: 0.9rem; }
        .btn-full { width: 100%; padding: 10px; background: var(--bg-surface); border: var(--border); color: var(--text-main); border-radius: 8px; cursor: pointer; margin-top: 5px; }
        .btn-full:hover { border-color: var(--primary); color: var(--primary); }
        input[type=range] { width: 100%; height: 4px; background: #333; -webkit-appearance: none; border-radius: 2px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: #fff; border-radius: 50%; cursor: pointer; transition: 0.2s; }
        input[type=range]:hover::-webkit-slider-thumb { background: var(--primary); transform: scale(1.2); }

        #ctx-menu { position: fixed; background: #181818; border: 1px solid #333; padding: 5px; border-radius: 6px; z-index: 2000; min-width: 160px; display: none; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .ctx-item { padding: 8px 12px; font-size: 0.85rem; cursor: pointer; color: #ddd; border-radius: 4px; }
        .ctx-item:hover { background: var(--primary); color: #000; }

        /* Toast */
        .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(20px); background: #111; border: 1px solid #333; color: #fff; padding: 10px 24px; border-radius: 30px; font-size: 0.9rem; pointer-events: none; opacity: 0; transition: 0.3s; z-index: 3000; box-shadow: 0 5px 20px rgba(0,0,0,0.4); display: flex; align-items: center; gap: 8px;}
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        @keyframes fadeUp { from { opacity:0; transform: translateY(15px); } to { opacity:1; transform:translateY(0); } }

        /* Mobile */
        @media(max-width: 800px) {
            #app { grid-template-columns: 1fr; grid-template-rows: 1fr 90px; }
            .sidebar { position: fixed; inset: 0; z-index: 200; transform: translateX(-100%); transition: 0.3s; background: #111; padding-top: 60px; }
            .sidebar.mobile-open { transform: translateX(0); }
            .panel { position: fixed; right: 0; top: 0; bottom: 90px; width: 300px; transform: translateX(100%); transition: 0.3s; z-index: 60;}
            .panel.mobile-open { transform: translateX(0); }
            .logo { justify-content: center; }
            #btn-mobile-menu, #btn-mobile-queue { display: block !important; }
        }
    </style>
</head>
<body>

<div id="app">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="logo">
            <svg width="24" height="24" fill="var(--primary)" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/></svg>
            ULTRAPLAY <span>v4</span>
        </div>
        
        <input type="text" class="search-box" id="search" placeholder="Search library...">

        <div class="nav-item" data-tab="playing" onclick="app.nav('playing')">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H8V4h12v12zM12 5.5v9l6-4.5z"/></svg>
            Now Playing
        </div>
        <div class="nav-item active" data-tab="library" onclick="app.nav('library')">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-6 2.5L18 9h-4V4.5zm-6 11V3.5L4 2v16h10v-1.5z"/></svg>
            All Media
        </div>
        <div class="nav-item" data-tab="audio" onclick="app.nav('audio')">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.2-1.75 4.45-4H15V6h4V3h-7z"/></svg>
            Audio Only
        </div>
        <div class="nav-item" data-tab="video" onclick="app.nav('video')">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"/></svg>
            Video Only
        </div>
        <div class="nav-item" data-tab="favorites" onclick="app.nav('favorites')">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3z"/></svg>
            Favorites
        </div>
        
        <div style="flex:1"></div>

        <div class="nav-item" onclick="$('#file-in').click()">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/></svg>
            Import Files
        </div>
        <div class="nav-item" onclick="app.openModal('settings-modal')">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L3.15 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
            Settings
        </div>
    </aside>

    <!-- Main View Area -->
    <main class="stage" id="main-stage">
        
        <!-- Player View -->
        <div id="view-player" class="view-section">
            <div class="ambient-bg" id="ambient"></div>
            <video id="video-el" playsinline crossorigin="anonymous"></video>
            <canvas id="visualizer"></canvas>
            <div id="empty-msg" class="empty-state">
                <svg width="64" height="64" fill="var(--bg-surface)" stroke="var(--text-muted)" viewBox="0 0 24 24"><path stroke-width="1" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/><path stroke-width="1" d="M10 8v8l6-4z"/></svg>
                <span>Select media from Library</span>
            </div>
        </div>

        <!-- Library View -->
        <div id="view-library" class="view-section active">
            <div class="view-header">
                <h2 style="margin:0" id="lib-title">All Media</h2>
                <div style="font-size:0.8rem; color:var(--text-muted)"><span id="lib-count">0</span> items</div>
            </div>
            <div class="lib-grid" id="lib-grid"></div>
        </div>

        <div id="toast" class="toast">Action completed</div>
    </main>

    <!-- Playlist/Queue Panel -->
    <aside class="panel" id="panel-right">
        <div class="panel-head">
            <span>Next Up</span>
            <span style="font-size:0.8rem; cursor:pointer; color:var(--primary)" onclick="queue.clear()">Clear All</span>
        </div>
        <div class="queue-list" id="queue-cont">
            <!-- Items injected by JS -->
        </div>
    </aside>

    <!-- Bottom Controls -->
    <div class="controls">
        <div class="seek-wrap" id="seek-bar">
            <div class="seek-bg"><div class="seek-fill" id="seek-fill"></div></div>
        </div>

        <!-- Left: Track Info -->
        <div class="track-info">
            <div class="track-thumb" id="curr-thumb"></div>
            <div class="track-meta">
                <div class="track-title" id="curr-title">No Media</div>
                <div class="track-time"><span id="curr-time">00:00</span> / <span id="total-time">00:00</span></div>
            </div>
            <button class="btn" title="Metadata" onclick="app.openModal('meta-modal')">
               <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/></svg>
            </button>
        </div>

        <!-- Center: Controls -->
        <div style="display:flex; align-items:center; gap:15px">
            <button class="btn" onclick="player.shuffle = !player.shuffle; ui.renderCtrls();" id="btn-shuffle">
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg>
            </button>
            <button class="btn" onclick="player.prev()">
                <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>
            </button>
            <button class="btn btn-big" onclick="player.toggle()" id="btn-play">
                <svg width="28" height="28" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            </button>
            <button class="btn" onclick="player.next()">
                <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
            </button>
            <button class="btn" onclick="player.loop = !player.loop; ui.renderCtrls();" id="btn-loop">
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg>
            </button>
        </div>

        <!-- Right: Volume & Options -->
        <div style="display:flex; align-items:center; gap:8px; justify-content: flex-end; width: 250px;">
             <button class="btn" onclick="app.openModal('eq-modal')" title="Audio EQ">
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/></svg>
            </button>
             <button class="btn" onclick="app.openModal('vid-modal')" title="Video Filter">
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14zM8 15c0-1.66 1.34-3 3-3 .35 0 .69.07 1 .18V6h5v2h-3v7.03A3.003 3.003 0 0 1 11 18c-1.66 0-3-1.34-3-3z"/></svg>
            </button>
            <input type="range" id="vol-slider" min="0" max="1" step="0.05" style="width: 80px" oninput="player.volume(this.value)">
            <button class="btn" onclick="document.fullscreenElement ? document.exitFullscreen() : document.body.requestFullscreen()">
                <svg width="22" height="22" fill="currentColor" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
            </button>
        </div>
    </div>
</div>

<!-- Invisible Inputs -->
<input type="file" id="file-in" multiple accept="video/*,audio/*" style="display:none" onchange="app.handleFiles(this)">
<input type="file" id="import-json" accept=".json" style="display:none" onchange="settings.import(this)">
<input type="file" id="sub-in" accept=".vtt,.srt" style="display:none" onchange="player.loadSub(this)">

<!-- Context Menu -->
<div id="ctx-menu"></div>

<!-- Modals -->
<div class="modal-mask" id="settings-modal" onclick="app.closeModal(event)">
    <div class="modal">
        <h2>System Settings <span onclick="app.closeModal(null, true)" style="cursor:pointer">&times;</span></h2>
        <div class="setting-grp">
            <div class="setting-row">
                <span>Theme Mode</span>
                <button class="btn-full" style="width: auto" onclick="app.toggleTheme()">Toggle Dark/Light</button>
            </div>
        </div>
        <div class="setting-grp">
            <div style="font-size:0.8rem; color:var(--text-muted); margin-bottom:8px">CONFIGURATION</div>
            <div style="display:flex; gap:10px">
                <button class="btn-full" onclick="settings.export()">Export Config</button>
                <button class="btn-full" onclick="$('#import-json').click()">Import Config</button>
            </div>
            <p style="font-size:0.7rem; color:var(--text-muted); margin-top:5px">Note: Only settings are exported, not media files.</p>
        </div>
        <button class="btn-full" style="border-color:#ff4444; color:#ff4444" onclick="settings.reset()">Factory Reset</button>
    </div>
</div>

<div class="modal-mask" id="eq-modal" onclick="app.closeModal(event)">
    <div class="modal">
        <h2>Audio Equalizer</h2>
        <div class="setting-row"><span>Bass</span><input type="range" min="-10" max="10" oninput="audio.setEq('low',this.value)" id="eq-low"></div>
        <div class="setting-row"><span>Mids</span><input type="range" min="-10" max="10" oninput="audio.setEq('mid',this.value)" id="eq-mid"></div>
        <div class="setting-row"><span>Treble</span><input type="range" min="-10" max="10" oninput="audio.setEq('high',this.value)" id="eq-high"></div>
        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:5px; margin-top:15px">
            <button class="btn-full" onclick="audio.preset('rock')">Rock</button>
            <button class="btn-full" onclick="audio.preset('vocal')">Vocal</button>
            <button class="btn-full" onclick="audio.preset('flat')">Flat</button>
        </div>
    </div>
</div>

<div class="modal-mask" id="vid-modal" onclick="app.closeModal(event)">
    <div class="modal">
        <h2>Video Enhancements</h2>
        <div class="setting-row"><span>Brightness</span><input type="range" min="0.5" max="1.5" step="0.1" value="1" oninput="player.filter('brightness',this.value)"></div>
        <div class="setting-row"><span>Contrast</span><input type="range" min="0.5" max="1.5" step="0.1" value="1" oninput="player.filter('contrast',this.value)"></div>
        <div class="setting-row"><span>Saturate</span><input type="range" min="0" max="2" step="0.1" value="1" oninput="player.filter('saturate',this.value)"></div>
        <hr style="border:0; border-top:var(--border); margin:15px 0">
        <div class="setting-row">
            <span>Subtitle</span>
            <button class="btn-full" style="width:auto" onclick="$('#sub-in').click()">Load .SRT/.VTT</button>
        </div>
    </div>
</div>

<div class="modal-mask" id="meta-modal" onclick="app.closeModal(event)">
    <div class="modal">
        <h2>File Properties <span onclick="app.closeModal(null, true)" style="cursor:pointer">&times;</span></h2>
        <div id="meta-body" style="line-height:1.6; font-size:0.9rem;">
            No media loaded.
        </div>
    </div>
</div>

<script>
/* CORE UTILITIES */
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);
const uuid = () => Math.random().toString(36).substr(2, 9);
const formatTime = t => {
    if (!t || isNaN(t)) return "00:00";
    let m = Math.floor(t / 60), s = Math.floor(t % 60);
    return `${m}:${s < 10 ? '0' : ''}${s}`;
};

/* INDEXEDDB - For Big Media Blobs */
class Database {
    constructor() { this.name = "UltraPlayV4"; this.ver = 1; this.db = null; }
    init() {
        return new Promise((res) => {
            let req = indexedDB.open(this.name, this.ver);
            req.onupgradeneeded = e => {
                let db = e.target.result;
                if (!db.objectStoreNames.contains("media")) db.createObjectStore("media", { keyPath: "id" });
            };
            req.onsuccess = e => { this.db = e.target.result; res(); };
        });
    }
    async add(file) {
        if(!this.db) await this.init();
        const item = {
            id: uuid(), name: file.name, type: file.type, size: file.size, 
            blob: file, added: Date.now(), fav: false, thumb: null
        };
        return new Promise(res => {
            let tx = this.db.transaction("media", "readwrite");
            tx.objectStore("media").add(item);
            tx.oncomplete = () => res(item);
        });
    }
    async getAll() {
        if(!this.db) await this.init();
        return new Promise(res => {
            this.db.transaction("media").objectStore("media").getAll().onsuccess = e => res(e.target.result);
        });
    }
    async update(item) {
        if(!this.db) await this.init();
        this.db.transaction("media", "readwrite").objectStore("media").put(item);
    }
    async remove(id) {
        if(!this.db) await this.init();
        this.db.transaction("media", "readwrite").objectStore("media").delete(id);
    }
}

/* LOCALSTORAGE - For Config/Settings */
const store = {
    state: {
        theme: 'dark', volume: 1, loop: false, shuffle: false, eq: {low:0, mid:0, high:0},
        lastMediaId: null, lastTime: 0, queue: [], activeTab: 'library',
        vidFilters: { brightness:1, contrast:1, saturate:1 }
    },
    load() {
        const local = localStorage.getItem("ultra_config");
        if(local) this.state = {...this.state, ...JSON.parse(local)};
        // Apply immediate non-media settings
        document.body.setAttribute("data-theme", this.state.theme);
        $$("#vol-slider")[0].value = this.state.volume;
        return this.state;
    },
    save() {
        // Debounce slightly to not hammer localstorage
        if(this._timer) clearTimeout(this._timer);
        this._timer = setTimeout(() => localStorage.setItem("ultra_config", JSON.stringify(this.state)), 500);
    }
};

/* SETTINGS IMPORT/EXPORT */
const settings = {
    export: () => {
        const blob = new Blob([JSON.stringify(store.state)], {type: "application/json"});
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "ultra_settings.json";
        a.click();
        app.toast("Config exported");
    },
    import: (el) => {
        const file = el.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = e => {
            try {
                const config = JSON.parse(e.target.result);
                store.state = {...store.state, ...config}; // Merge to avoid breaking missing keys
                store.save();
                location.reload();
            } catch(err) { app.toast("Invalid Config File"); }
        };
        reader.readAsText(file);
    },
    reset: () => {
        if(confirm("Reset all settings to default? Library will persist.")){
            localStorage.removeItem("ultra_config");
            location.reload();
        }
    }
};

/* APP LOGIC */
const app = {
    db: new Database(),
    items: [],
    
    init: async () => {
        const cfg = store.load();
        await app.db.init();
        await app.refreshLib();
        
        ui.setup();
        audio.init();
        
        // Restore Queue
        if (cfg.queue && cfg.queue.length > 0) {
            queue.list = cfg.queue.map(qid => app.items.find(i => i.id === qid)).filter(x => x);
            queue.render();
        }

        // URL / State Logic for Media
        const urlParams = new URLSearchParams(window.location.search);
        const urlId = urlParams.get("mediaId");
        
        const mediaToLoad = urlId || cfg.lastMediaId;
        
        if (mediaToLoad) {
            const item = app.items.find(i => i.id === mediaToLoad);
            if (item) {
                // If it was the URL ID, we autoplay. If it was simple refresh state, we load but don't auto-play
                await player.load(item, !urlId); 
                if(!urlId && cfg.lastTime) {
                    player.el.currentTime = cfg.lastTime;
                }
            }
        }
        
        app.nav(cfg.activeTab); // Restore tab
        
        // Listeners for import drag
        document.ondragover = e => e.preventDefault(); // Stop standard open
        $('.sidebar').ondragover = e => { e.preventDefault(); $('.sidebar').classList.add('drop-target'); };
        $('.sidebar').ondragleave = e => $('.sidebar').classList.remove('drop-target');
        $('.sidebar').ondrop = async e => {
            e.preventDefault();
            $('.sidebar').classList.remove('drop-target');
            if(e.dataTransfer.files.length) await app.processFiles(e.dataTransfer.files);
        };
    },
    
    nav: (tab) => {
        store.state.activeTab = tab;
        store.save();
        
        // UI Tabs
        $$(".nav-item").forEach(n => n.classList.remove("active"));
        const btn = $(`.nav-item[data-tab="${tab}"]`);
        if(btn) btn.classList.add("active");

        // Logic
        if (tab === 'playing') {
            $$(".view-section").forEach(el => el.classList.remove("active"));
            $("#view-player").classList.add("active");
        } else {
            // It is a library view
            $$(".view-section").forEach(el => el.classList.remove("active"));
            $("#view-library").classList.add("active");
            
            // Filters
            let list = app.items;
            let title = "All Media";
            if (tab === 'audio') { list = app.items.filter(i => i.type.startsWith('audio')); title = "Audio Files"; }
            if (tab === 'video') { list = app.items.filter(i => i.type.startsWith('video')); title = "Video Files"; }
            if (tab === 'favorites') { list = app.items.filter(i => i.fav); title = "Favorites"; }
            
            $("#lib-title").innerText = title;
            ui.renderGrid(list);
        }
    },
    
    handleFiles: (el) => app.processFiles(el.files),
    
    processFiles: async (files) => {
        app.toast(`Importing ${files.length} items...`);
        for (let f of files) await app.db.add(f);
        await app.refreshLib();
        app.toast("Import Complete");
        if(app.items.length === files.length) {
            // First time load, auto play first
            player.load(app.items[0]);
            queue.add(app.items[0]);
        }
    },
    
    refreshLib: async () => {
        app.items = await app.db.getAll();
        $("#lib-count").innerText = app.items.length;
        // re-render current view if library
        if(store.state.activeTab !== 'playing') app.nav(store.state.activeTab);
    },
    
    toggleTheme: () => {
        const n = document.body.getAttribute("data-theme") === "dark" ? "light" : "dark";
        document.body.setAttribute("data-theme", n);
        store.state.theme = n;
        store.save();
    },

    toggleFav: async (id, e) => {
        if(e) e.stopPropagation();
        const item = app.items.find(i => i.id === id);
        if(item) {
            item.fav = !item.fav;
            await app.db.update(item);
            app.refreshLib();
        }
    },
    
    removeMedia: async (id) => {
        if(confirm("Permanently delete this file?")) {
            await app.db.remove(id);
            location.reload(); 
        }
    },

    openModal: (id) => {
        app.closeModal(null, true);
        const el = document.getElementById(id);
        if(el) { 
            el.classList.add('open');
            // update metadata if meta modal
            if(id==='meta-modal') {
                if(!player.active) { $("#meta-body").innerHTML = "No Active File"; return;}
                const i = player.active;
                $("#meta-body").innerHTML = `
                    <strong>File:</strong> ${i.name}<br>
                    <strong>Size:</strong> ${(i.size/1048576).toFixed(2)} MB<br>
                    <strong>Type:</strong> ${i.type}<br>
                    <strong>ID:</strong> ${i.id}<br><hr style="border:0; border-top:1px solid #444">
                    <strong>Resolution:</strong> ${player.el.videoWidth || 'N/A'} x ${player.el.videoHeight || 'N/A'}<br>
                    <strong>Duration:</strong> ${player.el.duration.toFixed(2)}s
                `;
            }
        }
    },
    closeModal: (e, force) => {
        if(force || e.target.classList.contains('modal-mask')) {
            $$('.modal-mask').forEach(m => m.classList.remove('open'));
        }
    },
    toast: (msg) => {
        const t = $("#toast");
        t.innerText = msg;
        t.classList.add("show");
        setTimeout(() => t.classList.remove("show"), 3000);
    }
};

/* AUDIO SYSTEM (EQ & Vis) */
const audio = {
    ctx: null, source: null,
    init: () => {
        try {
            const AC = window.AudioContext || window.webkitAudioContext;
            audio.ctx = new AC();
            audio.analyser = audio.ctx.createAnalyser();
            audio.analyser.fftSize = 256;
            
            // Create EQ nodes
            audio.bands = {
                low: audio.ctx.createBiquadFilter(),
                mid: audio.ctx.createBiquadFilter(),
                high: audio.ctx.createBiquadFilter()
            };
            audio.bands.low.type = "lowshelf"; audio.bands.low.frequency.value = 320;
            audio.bands.mid.type = "peaking"; audio.bands.mid.frequency.value = 1000;
            audio.bands.high.type = "highshelf"; audio.bands.high.frequency.value = 3200;

            const st = store.state.eq;
            audio.setEq('low', st.low); audio.setEq('mid', st.mid); audio.setEq('high', st.high);
            $$('#eq-low')[0].value=st.low; $$('#eq-mid')[0].value=st.mid; $$('#eq-high')[0].value=st.high;
            
            // Connect happens in player.load
            audio.loopVis();
        } catch(e) { console.log("Audio Context Err", e); }
    },
    connect: (videoEl) => {
        if (!audio.ctx) return;
        if (audio.source) return; // already connected
        audio.source = audio.ctx.createMediaElementSource(videoEl);
        audio.source.connect(audio.bands.low)
                    .connect(audio.bands.mid)
                    .connect(audio.bands.high)
                    .connect(audio.analyser)
                    .connect(audio.ctx.destination);
    },
    setEq: (band, val) => {
        if(audio.bands[band]) audio.bands[band].gain.value = val;
        store.state.eq[band] = val;
        store.save();
    },
    preset: (type) => {
        const p = { rock: [5, -2, 5], vocal: [-2, 5, 2], flat: [0, 0, 0] };
        const [l, m, h] = p[type];
        audio.setEq('low', l); audio.setEq('mid', m); audio.setEq('high', h);
        $('#eq-low').value = l; $('#eq-mid').value = m; $('#eq-high').value = h;
        app.toast("EQ Preset: " + type);
    },
    loopVis: () => {
        const cvs = $("#visualizer");
        const ctx = cvs.getContext("2d");
        const buffer = new Uint8Array(audio.analyser.frequencyBinCount);
        
        const draw = () => {
            requestAnimationFrame(draw);
            // Optimization: Only draw if visible and playing audio
            if(!player.active || !player.active.type.startsWith("audio") || player.el.paused) {
                if (cvs.width > 0) ctx.clearRect(0,0, cvs.width, cvs.height);
                return;
            }
            
            audio.analyser.getByteFrequencyData(buffer);
            cvs.width = cvs.clientWidth; 
            cvs.height = cvs.clientHeight;
            ctx.clearRect(0,0, cvs.width, cvs.height);
            
            const barW = (cvs.width / buffer.length) * 2.5;
            let x = 0;
            
            for(let i=0; i<buffer.length; i++) {
                const h = (buffer[i] / 255) * cvs.height * 0.9;
                ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--primary');
                ctx.fillRect(x, cvs.height - h, barW, h);
                x += barW + 1;
            }
        };
        draw();
    }
};

/* QUEUE SYSTEM */
const queue = {
    list: [],
    add: (item) => {
        if(queue.list.some(i => i.id === item.id)) return; // Prevent dupes
        queue.list.push(item);
        queue.save();
        queue.render();
        app.toast("Added to Queue");
        // Auto play if only item
        if(queue.list.length === 1 && player.el.paused) player.load(item);
    },
    remove: (idx, e) => {
        e.stopPropagation();
        queue.list.splice(idx, 1);
        queue.save();
        queue.render();
    },
    clear: () => {
        queue.list = [];
        queue.save();
        queue.render();
    },
    save: () => {
        store.state.queue = queue.list.map(i => i.id);
        store.save();
    },
    render: () => {
        const c = $("#queue-cont");
        c.innerHTML = "";
        queue.list.forEach((item, idx) => {
            const div = document.createElement("div");
            div.className = `q-item ${player.active && player.active.id === item.id ? 'active' : ''}`;
            div.draggable = true;
            div.innerHTML = `
                <div style="width:30px;height:30px;background:#333;border-radius:4px;background-size:cover;background-image:url(${item.thumb||''})"></div>
                <div style="flex:1; overflow:hidden; white-space:nowrap; text-overflow:ellipsis;">${item.name}</div>
                <div onclick="queue.remove(${idx}, event)" style="padding:4px">&times;</div>
            `;
            div.onclick = () => player.load(item);
            
            // Drag Drop Sorting
            div.ondragstart = e => { e.dataTransfer.setData("idx", idx); div.classList.add("dragging"); };
            div.ondragend = () => div.classList.remove("dragging");
            div.ondragover = e => e.preventDefault();
            div.ondrop = e => {
                e.preventDefault();
                const oldIdx = e.dataTransfer.getData("idx");
                const item = queue.list.splice(oldIdx, 1)[0];
                queue.list.splice(idx, 0, item);
                queue.save();
                queue.render();
            };
            c.appendChild(div);
        });
    }
};

/* PLAYER ENGINE */
const player = {
    el: $("#video-el"),
    active: null,
    srcBlob: null,
    shuffle: false, loop: false,
    
    load: async (item, paused = false) => {
        if (player.srcBlob) URL.revokeObjectURL(player.srcBlob);
        
        player.active = item;
        store.state.lastMediaId = item.id;
        
        // Sync URL without reloading
        const url = new URL(window.location);
        url.searchParams.set("mediaId", item.id);
        window.history.replaceState({}, "", url);
        store.save();

        player.srcBlob = URL.createObjectURL(item.blob);
        player.el.src = player.srcBlob;
        
        // Initialize Audio context chain on first interaction
        if(!audio.source) audio.connect(player.el);

        if(!paused) {
            try { await player.el.play(); } catch(e){}
        }
        
        // Update Metadata UI
        $("#curr-title").innerText = item.name;
        $("#curr-thumb").style.backgroundImage = item.thumb ? `url(${item.thumb})` : 'none';
        
        // Handling visuals based on type
        const isAudio = item.type.startsWith("audio");
        player.el.style.opacity = isAudio ? 0 : 1; // Hide video el for audio, let Vis show
        
        // Generate Thumbnail if needed
        if(!item.thumb && !isAudio) ui.genThumb(item);
        
        $("#empty-msg").style.display = 'none';
        ui.renderCtrls();
        queue.render(); // Update active highlight
    },

    toggle: () => player.el.paused ? player.el.play() : player.el.pause(),
    
    next: () => {
        if(!queue.list.length) return;
        let idx = queue.list.findIndex(i => i.id === player.active?.id);
        
        if (player.shuffle) {
            idx = Math.floor(Math.random() * queue.list.length);
        } else {
            idx = idx + 1;
            if(idx >= queue.list.length) idx = 0; // standard loop wrap
        }
        player.load(queue.list[idx]);
    },
    
    prev: () => {
        if(!queue.list.length) return;
        let idx = queue.list.findIndex(i => i.id === player.active?.id);
        if(idx > 0) idx--; else idx = queue.list.length - 1;
        player.load(queue.list[idx]);
    },
    
    volume: (v) => {
        player.el.volume = v;
        store.state.volume = v;
        store.save();
    },
    
    filter: (type, val) => {
        store.state.vidFilters[type] = val;
        const f = store.state.vidFilters;
        player.el.style.filter = `brightness(${f.brightness}) contrast(${f.contrast}) saturate(${f.saturate})`;
        store.save();
    },
    
    loadSub: (input) => {
        const file = input.files[0];
        const track = document.createElement("track");
        track.kind = "captions";
        track.label = "English";
        track.srclang = "en";
        track.src = URL.createObjectURL(file);
        track.default = true;
        player.el.innerHTML = "";
        player.el.appendChild(track);
        app.toast("Subtitles Loaded");
    }
};

/* PLAYER EVENTS */
player.el.onended = () => player.loop ? player.el.play() : player.next();
player.el.ontimeupdate = () => {
    if(!player.el.duration) return;
    const pct = (player.el.currentTime / player.el.duration) * 100;
    $("#seek-fill").style.width = pct + "%";
    $("#curr-time").innerText = formatTime(player.el.currentTime);
    $("#total-time").innerText = formatTime(player.el.duration);
    
    // Save state periodically (not every frame)
    if (Math.floor(player.el.currentTime) % 5 === 0) {
        store.state.lastTime = player.el.currentTime;
        store.save();
    }
};
// Global hotkeys
window.onkeydown = e => {
    if(e.target.tagName === 'INPUT') return;
    if(e.code === "Space") { e.preventDefault(); player.toggle(); }
    if(e.code === "ArrowRight") player.el.currentTime += 5;
    if(e.code === "ArrowLeft") player.el.currentTime -= 5;
    if(e.code === "ArrowUp") { e.preventDefault(); player.el.volume = Math.min(1, player.el.volume+0.1); $("#vol-slider").value = player.el.volume; }
    if(e.code === "ArrowDown") { e.preventDefault(); player.el.volume = Math.max(0, player.el.volume-0.1); $("#vol-slider").value = player.el.volume; }
};

/* UI UTILS */
const ui = {
    setup: () => {
        $("#seek-bar").onclick = e => {
            const rect = $("#seek-bar").getBoundingClientRect();
            const pos = (e.clientX - rect.left) / rect.width;
            player.el.currentTime = pos * player.el.duration;
        };
        // Filters restore
        const f = store.state.vidFilters;
        $$("#vid-modal input[type=range]").forEach((el, i) => {
            if(i===0) el.value = f.brightness;
            if(i===1) el.value = f.contrast;
            if(i===2) el.value = f.saturate;
        });
        // Initial setup for existing session
        player.filter('brightness', f.brightness);
        
        // Search
        $("#search").oninput = (e) => {
            const term = e.target.value.toLowerCase();
            const res = app.items.filter(i => i.name.toLowerCase().includes(term));
            ui.renderGrid(res);
        };
        
        // Context menu close
        document.onclick = (e) => { 
            if(!e.target.closest('#ctx-menu')) $('#ctx-menu').style.display='none';
        }
    },
    
    renderGrid: (items) => {
        const grid = $("#lib-grid");
        grid.innerHTML = "";
        items.forEach(item => {
            const el = document.createElement("div");
            el.className = "media-card";
            el.innerHTML = `
                <div class="thumb" style="${item.thumb ? 'background-image:url('+item.thumb+')' : ''}">
                   ${!item.thumb && item.type.startsWith('audio') ? '<svg width="40" height="40" fill="#444" viewBox="0 0 24 24"><path d="M12 3v9.28a4.39 4.39 0 00-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.2-1.75 4.45-4H15V6h4V3h-7z"/></svg>' : ''}
                   <div class="btn-fav-card ${item.fav ? 'is-fav':''}" onclick="app.toggleFav('${item.id}', event)">
                        <svg width="20" height="20" fill="${item.fav ? '#ff4444':'#fff'}" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                   </div>
                </div>
                <div class="info">
                    <div class="title" title="${item.name}">${item.name}</div>
                    <div class="meta"><span>${(item.size/1048576).toFixed(1)}MB</span><span>${item.type.split('/')[1].toUpperCase()}</span></div>
                </div>
            `;
            el.onclick = () => { queue.add(item); };
            el.oncontextmenu = (e) => {
                e.preventDefault();
                ui.showCtx(e, item);
            };
            grid.appendChild(el);
        });
    },

    genThumb: (item) => {
        // Simple trick: capture frame from temp video
        const vid = document.createElement("video");
        vid.src = URL.createObjectURL(item.blob);
        vid.muted = true;
        vid.currentTime = 5; // seek a bit
        vid.onloadeddata = () => {
             // wait for seek
             setTimeout(() => {
                 const cvs = document.createElement("canvas");
                 cvs.width = 320; cvs.height = 180;
                 cvs.getContext('2d').drawImage(vid, 0,0, cvs.width, cvs.height);
                 item.thumb = cvs.toDataURL("image/jpeg", 0.5);
                 app.db.update(item);
                 // force redraw if library active
                 if(store.state.activeTab === 'library' || store.state.activeTab === 'video') app.refreshLib();
                 if(player.active && player.active.id === item.id) $("#curr-thumb").style.backgroundImage = `url(${item.thumb})`;
             }, 500);
        };
    },

    renderCtrls: () => {
        $("#btn-play").innerHTML = player.el.paused ? 
            '<svg width="28" height="28" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>' :
            '<svg width="28" height="28" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
        
        $("#btn-loop").classList.toggle("active", player.loop);
        $("#btn-shuffle").classList.toggle("active", player.shuffle);
    },

    showCtx: (e, item) => {
        const m = $("#ctx-menu");
        m.style.display = "block";
        m.style.left = Math.min(e.clientX, window.innerWidth - 170) + "px";
        m.style.top = e.clientY + "px";
        m.innerHTML = `
            <div class="ctx-item" onclick="player.load(app.items.find(i=>i.id=='${item.id}'))">Play Now</div>
            <div class="ctx-item" onclick="queue.add(app.items.find(i=>i.id=='${item.id}'))">Add to Queue</div>
            <hr style="border:0; border-top:1px solid #333; margin:4px 0">
            <div class="ctx-item" onclick="app.removeMedia('${item.id}')" style="color:#ff4444">Delete File</div>
        `;
    }
};

// Start System
player.el.onplay = ui.renderCtrls;
player.el.onpause = ui.renderCtrls;
app.init();

</script>
</body>
</html>